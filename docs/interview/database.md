---
icon: note
date: 2022-01-11
category:
  - 面经汇总
tag:
  - 数据库面试题
---
# 数据库面试题
## 一、基础概念篇

## 1、主键、外键、超键、候选键

+ **主键：**数据库表中，对存储数据对象予以唯一和完整标识的数据列或属性的组合。一个数据列只能有一个主键，且主键的取值不能缺失，即不能为空值(NULL)。
+ **外键：**在一个表中存在另一个表的主键称为该表的外键。
+ **超键：**在关系中能唯一标识元组的属性集称为关系模式的超键。一个属性可以作为一个超键，多个属性组合在一起也可以作为一个超键，超键包含候选键和主键。
+ **候选键：**是最小超键，即没有冗余元素的超键。

## 2、为什么用自增列作为主键

如果我们定义了主键，那么InnoDB会选择主键作为聚簇索引，如果没有显示定义主键，则InnoDB会选择第一个不包含有NULL值的唯一索引作为主键索引，如果没有这样的唯一索引，则InnoDB会选择内置6字节长度的ROWID作为隐含的聚簇索引（ROWIN随着行记录的写入而主键递增，这个ROWID不像ORACLE的ROWID那样可引用，是隐含的）。

数据记录本身被存于主索引（一棵B+Tree）的叶子节点上，这就要求同一个叶子节点内（大小为一个内存页或磁盘页）的各条数据记录按主键顺序存放，因此每当有一条新的记录插入时，MySQL会根据其主键将其插入适当的节点和位置，如果页面达到装载因子（InnoDB默认为15/16），则开辟一个新的页（节点）。

如果表使用自增主键，那么每次插入新的记录，记录就会顺序添加到当前索引节点的后续位置，当一页写满，就会自动开辟一个新的页。

如果使用非自增主键（例如身份证号或学号），由于每次插入主键的值近似于随机，因此每次新纪录都要被查到现有索引的中间某个位置，此时MySQL不得不为了将新纪录插入到合适的位置而移动数据，甚至目标页面可能已经被回写到磁盘上而从缓存中清代哦，此时又要从磁盘上读取回来，这增加了很多开销，同时频繁地移动、分页操作造成了大量的碎片，得到了不够紧凑的索引结构，后续不得不通过OPTIMIZE TABLE来重建表并优化填充页面。

## 3、触发器的作用

触发器是一种特殊的存储过程，主要是通过时间来触发而被执行的。它可以强化约束，来维护数据的完整性和一致性，可以跟踪数据库内的操作从而不允许未经许可的更新和变化。可以联级运算，如：某表上的触发器上包含对另一个表的数据操作，而该操作又会导致该表触发器被触发。

## 4、什么是存储过程？用什么来调用?

存储过程是一个预编译的SQL语句，优点是允许模块化的设计，就是说只需创建一次，以后在该程序中就可以调用多次。如果某次操作需要执行多次SQL，使用存储过程比单纯的SQL语句执行要快。

**调用：**

+ 可以用一个命令对象来调用存储过程。
+ 可以供外部程序调用，比如：java程序。

## 5、存储过程的优缺点？

**优点：**

+ 存储过程是预编译过的，执行效率高。
+ 存储过程的代码直接存放于数据库中，通过存储过程名直接调用，减少网络通讯。
+ 安全性高，执行存储过程需要一定权限的用户。
+ 存储过程可以重复使用，可减少数据库开发人员的工作量。

**缺点：**移植性差。

## 6、存储过程和函数的区别

| 存储过程                                             | 函数                                                         |
| ---------------------------------------------------- | ------------------------------------------------------------ |
| 用于在数据库中完成特定的操作或者任务(如插入、删除等) | 用于特定的数据                                               |
| 程序头部声明用procedure                              | 程序头部声明用function                                       |
| 程序头部声明时不需要描述返回类型                     | 程序头部声明时要描述返回类型，而且PL/SQL块中至少要包含一个有效的return语句 |
| 可以使用in/out/in out三种模式的参数                  | 可以使用in/out/in out三种模式的参数                          |
| 可以作为一个独立的PL/SQL语句来执行                   | 不能独立执行，必须作为表达式一部分调用                       |
| 可以通过out/in out返回零个或多个值                   | 通过return语句返回一个值，且该值要与声明部分一致，也可以通过out类型的参数带出的变量 |
| SQL语句(DML或SELECT)中不可调用存储过程               | SQL语句(DML或SELECT)中可以调用函数                           |

## 7、什么是视图和游标

**视图：**是一种虚拟的表，具有和物理表相同的功能。可以对视图进行增、改、删、查操作，视图通常是有一个表或者多个表的行或列的子集。对试图的修改会影响基本表，相比多表查询，它使我们获得数据更容易。

**游标：**是对查询出来的结果集作为一个单元来有效的处理。游标可以定在该单元中的特定行，从结果集的当前行索引一行或多行。可以对结果集当前行做修改。一般不使用游标，但是需要逐条处理数据的时候，游标显得十分重要。

## 8、视图的优缺点

**优点：**

+ 对数据库的访问，因为视图可以有选择性的选取数据库里的一部分。
+ 用户通过简单的查询可以从复杂查询中得到结果。
+ 维护数据的独立性，视图可以从多个表检索数据。
+ 对于相同的数据可产生不同的视图。

**缺点：**

+ 性能，查询视图时，必须把视图的查询转化成对基本表的查询，如果这个视图是由一个复杂的多表查询所定义，那么就无法更改数据。

## 9、drop、truncate、delete的区别



## 1、说一说你对redo log、undo log和bin log的了解

bin log是在服务层实现的；redo log和undo log是在引擎层实现的，且是innodb引擎独有的，主要和事务相关。

bin log中记录的是整个mysql数据库的操作内容，对所有的引擎都适用，包括执行DDL、DML，可以用来进行数据库的恢复及控制。

redo log中记录的是要更新的数据，比如一条数据已提交成功，并不会立即同步到磁盘，而是记录到redo log中，等待合适的时机再刷盘，为了实现事务的持久性。 

undo log中记录的是当前操作的相反操作，如一条insert语句在undo log中会对应一条delete语句，在任务回滚时会用到undo log,实现事务的原子性，同时会用在MVCC中，undo会有一条记录的多个版本，用在快照读中。

## 2、MySQL一个select语句的执行过程

+ 第一步是建立连接，通过TCP简历连接后，连接器通过输入的账户和密码验证身份，认证通过后查询该身份拥有的权限，以后的操作都需要依赖于现有的权限；

+ 第二步连接建立完成后就可以执行select指令，服务层首先会去查询缓存，看看能够在缓存中找到该条语句，如果可以能够直接返回数据，如果不在就需要执行后面的步骤；

+ 第三步分析器会先做词法分析，识别出输入的字符串代表什么意思，接着做语法分析，判断语句是否满足MySQL语法，然后优化器对语句进行优化，比如有多个索引时具体使用哪一个等等；

+ 第四步所有工作都完成后执行器就要执行语句了，首先会判断一下有没有执行权限，然后调用对应数据引擎的接口，查找需要的数据，作为结果集返还给用户。

## 3、MySQL存储引擎

MySQL数据库主要分为服务层和存储引擎层，服务层主要完成连接、缓存查询、词法分析、语法分析、优化、执行等等操作，是面向用户给出的接口；而存储引擎层是数据库的核心，负责对数据的管理，包括更新、删除、查询等等，提供接口给服务层。MYSQL的存储引擎是以插件的方式给出的，也就是说MySQL支持多种不同的存储引擎，包括InnoDB、MyISAM、Memory等，可以根据具体场景需求选择建立表的时候使用什么引擎，从MySQL5.5.5开始，默认使用InnoDB。

## 4、InnoDB、MyISAM以及Memory的区别

+ InnoDB通过支持事务，使用的锁粒度是行级锁，可以支持更高的并发；支持外键约束，虽然降低了查询速度，但是可以增加表之间的耦合度；

+ MyISAM拥有较高的插入、查询速度，内存使用较小，但是不支持事务和外键；

+ MEMORY是MySQL中一类特殊的存储引擎。它使用存储在内存中的内容来创建表，而且数据全部放在内存中。这些特性与前面的两个很不同。
  每个基于MEMORY存储引擎的表实际对应一个磁盘文件。该文件的文件名与表名相同，类型为frm类型。该文件中只存储表的结构。而其数据文件，都是存储在内存中，这样有利于数据的快速处理，提高整个表的效率。值得注意的是，服务器需要有足够的内存来维持MEMORY存储引擎的表的使用。如果不需要了，可以释放内存，甚至删除不需要的表。
  MEMORY默认使用哈希索引。速度比使用B型树索引快。当然如果你想用B型树索引，可以在创建索引时指定。

## 5、聚簇索引和非聚簇索引的区别

+ 聚簇索引，表数据是按照索引的顺序来存储的，也即是索引项的顺序与表中记录的物理顺序是一致的，对于聚簇索引，叶子节点存储的就是数据行，并且一张表上最多只能创建一个聚簇索引，因为数据的物理顺序只能有一种；

+ 非聚簇索引，表数据与索引顺序无关，且叶子节点不是直接记录行数据，二是记录了指向行数据的逻辑指针，需要通过这个指针去数据页找到对应的数据。

## 6、事务的特性有哪些

+ 原子性，一个事务必须被视为不可分割的最小工作单元，整个事务中的所有操作要么全部提交成功，要么全部失败回滚，对于一个事务来说，不可能执行其中某一部分；

+ 一致性，几个并行执行的事务，其执行结果必须与按某一顺序串行执行的结果相一致，数据库总是从一个一致性的状态转移到另一个一致性的状态；

+ 隔离性，事务的执行不受其他事务的干扰，事务执行的中间结果对其他事务必须是透明的；

+ 持久性，对于任意已提交事务，系统必须保证该事务对数据库的改变不被丢失，即使数据库出现故障。  